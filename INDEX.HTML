<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Shri 1008 SVSM Construction ERP</title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <!-- XLSX & html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    /* ========= GLOBAL ========= */
    * { box-sizing:border-box; margin:0; padding:0; font-family:'Inter',sans-serif; }
    body { background:#2C3E50; color:#ECF0F1; overflow:hidden; }
    button, input, select, textarea { font-family:inherit; }
    /* ===== LOGIN ===== */
    #login, #app { position:absolute; top:0; left:0; width:100%; height:100%; }
    #login { display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.7); }
    #login form {
      background:#34495E; padding:2rem; border-radius:8px; width:320px;
      box-shadow:0 4px 12px rgba(0,0,0,0.4);
    }
    #login h2 { text-align:center; margin-bottom:1rem; font-weight:400; color:#1ABC9C; }
    #login input, #login button {
      width:100%; padding:.75rem 1rem; margin:.5rem 0; border:none; border-radius:4px;
    }
    #login input { background:#3E556E; color:#ECF0F1; }
    #login button { background:#1ABC9C; color:#2C3E50; font-weight:600; }
    #login .error { display:none; color:#E74C3C; text-align:center; margin-top:.5rem; }

    /* ===== APP LAYOUT ===== */
    header {
      position:fixed; top:0; left:0; right:0; height:60px;
      background:#34495E; display:flex; align-items:center; padding:0 1.5rem;
      box-shadow:0 2px 6px rgba(0,0,0,0.3); z-index:10;
    }
    header img { height:36px; margin-right:.75rem; }
    header h1 { font-size:1.25rem; font-weight:400; }

    aside {
      position:fixed; top:60px; left:0; bottom:0; width:200px;
      background:#3E556E; padding:1rem; overflow-y:auto;
    }
    aside a {
      display:flex; align-items:center; padding:.5rem; margin:.25rem 0;
      color:#BDC3C7; text-decoration:none; border-radius:4px;
      transition:background .3s, color .3s;
    }
    aside a.active,
    aside a:hover { background:#1ABC9C; color:#2C3E50; }

    main {
      position:fixed; top:60px; left:200px; right:0; bottom:0;
      padding:1.5rem; overflow-y:auto;
    }

    /* ===== SECTION ===== */
    .section { margin-bottom:1.5rem; background:#34495E; border-radius:8px; overflow:hidden; }
    .section .hdr {
      background:#2C3E50; padding:1rem; display:flex; justify-content:space-between; align-items:center;
      cursor:pointer; user-select:none;
    }
    .section .hdr h2 { font-size:1rem; font-weight:400; color:#1ABC9C; }
    .section .hdr .arrow { transition:transform .3s; }
    .section.collapsed .hdr .arrow { transform:rotate(-90deg); }
    .section .cnt { padding:1rem; }
    .section.collapsed .cnt { display:none; }

    /* ===== FORMS & TABLES ===== */
    form input, form select, form textarea {
      width:100%; padding:.5rem .75rem; margin:.5rem 0; border:none; border-radius:4px;
      background:#3E556E; color:#ECF0F1;
    }
    form button {
      background:#1ABC9C; color:#2C3E50; padding:.6rem 1.2rem; border:none; border-radius:4px;
      font-weight:600; margin-top:.5rem;
    }
    .exp-btns button {
      margin-right:.5rem; background:#1ABC9C; color:#2C3E50;
    }
    table { width:100%; border-collapse:collapse; margin-top:.75rem; }
    th,td {
      padding:.5rem .75rem; text-align:left; border-bottom:1px solid #2C3E50;
    }
    th { background:#2C3E50; font-weight:400; }
    td { background:#3E556E; }
    .actions button {
      background:#1ABC9C; color:#2C3E50; padding:.3rem .6rem; border:none; border-radius:4px;
      margin-right:.3rem; font-size:.85rem;
    }

    /* hide scrollbars until needed */
    main::-webkit-scrollbar { width:6px; }
    main::-webkit-scrollbar-thumb { background:rgba(26,188,156,0.6); border-radius:3px; }
  </style>
</head>
<body>

  <!-- LOGIN SCREEN -->
  <div id="login">
    <form onsubmit="return doLogin()">
      <h2>SVSM ERP Login</h2>
      <input id="li-user" placeholder="Username" required/>
      <input id="li-pass" type="password" placeholder="Password" required/>
      <button type="submit">Sign In</button>
      <p class="error" id="li-err">Invalid credentials</p>
    </form>
  </div>

  <!-- APP -->
  <div id="app" style="display:none;">
    <header>
      <img src="logo.png" alt="Logo"/>
      <h1>Shri 1008 SVSM Construction Co.</h1>
    </header>

    <aside>
      <a href="#" id="nav-emp" class="active" onclick="show('emp')">👥 Employees</a>
      <a href="#" id="nav-att" onclick="show('att')">🕒 Attendance</a>
      <a href="#" id="nav-sal" onclick="show('sal')">💰 Salary</a>
      <a href="#" id="nav-usr" onclick="show('usr')">👤 Users</a>
      <a href="#" id="nav-bak" onclick="show('bak')">🔄 Backup</a>
      <a href="#" style="margin-top:1rem;color:#E74C3C;" onclick="logout()">🚪 Logout</a>
    </aside>

    <main>
      <!-- EMPLOYEES -->
      <div id="emp" class="section">
        <div class="hdr" onclick="toggle(this)">
          <h2>Employee Management</h2><span class="arrow">▼</span>
        </div>
        <div class="cnt">
          <form onsubmit="addEmp();return false;">
            <input id="e-name" placeholder="Full Name" required/>
            <input id="e-role" placeholder="Role / Designation" required/>
            <input id="e-sal" type="number" placeholder="Salary (₹)" required/>
            <input id="e-bank" placeholder="Bank A/C No." required/>
            <input id="e-ifsc" placeholder="IFSC Code" required/>
            <textarea id="e-addr" rows="2" placeholder="Address"></textarea>
            <input id="e-att" type="file"/>
            <button>Add / Save</button>
          </form>
          <div class="exp-btns">
            <button onclick="exportTable('empTbl','employees.xlsx')">Export Excel</button>
            <button onclick="exportPDF('emp','employees.pdf')">Export PDF</button>
          </div>
          <table id="empTbl">
            <thead><tr>
              <th>ID</th><th>Name</th><th>Role</th><th>Salary</th><th>Bank</th>
              <th>IFSC</th><th>Address</th><th>Doc</th><th>Actions</th>
            </tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- ATTENDANCE -->
      <div id="att" class="section collapsed">
        <div class="hdr" onclick="toggle(this)">
          <h2>Attendance</h2><span class="arrow">▼</span>
        </div>
        <div class="cnt">
          <form onsubmit="addAtt();return false;">
            <select id="att-emp2" required></select>
            <input id="att-date" type="date" required/>
            <input id="att-in2" type="time" required/>
            <input id="att-out2" type="time" required/>
            <button>Mark Attendance</button>
          </form>
          <div class="exp-btns">
            <button onclick="exportTable('attTbl2','attendance.xlsx')">Export Excel</button>
            <button onclick="exportPDF('att','attendance.pdf')">Export PDF</button>
          </div>
          <table id="attTbl2">
            <thead><tr><th>ID</th><th>Employee</th><th>Date</th><th>In</th><th>Out</th><th>Actions</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- SALARY -->
      <div id="sal" class="section collapsed">
        <div class="hdr" onclick="toggle(this)">
          <h2>Salary Slip</h2><span class="arrow">▼</span>
        </div>
        <div class="cnt">
          <form onsubmit="genSingle();return false;">
            <select id="sal-emp2" required></select>
            <select id="sal-month" required>
              <option>Jan</option><option>Feb</option><option>Mar</option><option>Apr</option>
              <option>May</option><option>Jun</option><option>Jul</option><option>Aug</option>
              <option>Sep</option><option>Oct</option><option>Nov</option><option>Dec</option>
            </select>
            <input id="sal-year" type="number" value="2025" required/>
            <button>Generate Single</button>
            <button type="button" onclick="genAll()">Generate Bulk</button>
          </form>

          <!-- Single Slip Preview -->
          <div id="one" style="display:none;margin-top:1rem;padding:1rem;background:#3E556E;border-radius:6px;">
            <img src="logo.png" style="height:36px;margin-bottom:.75rem;display:block;"/>
            <h3 style="color:#1ABC9C;margin-bottom:.5rem;">Salary Slip</h3>
            <p><strong>Name:</strong> <span id="one-n"></span></p>
            <p><strong>Role:</strong> <span id("one-r")=""></span></p>
            <p><strong>Date:</strong> <span id="one-d"></span></p>
            <p><strong>Salary:</strong> ₹<span id="one-s"></span></p>
            <div class="exp-btns">
              <button onclick="exportPDF('one','slip.pdf')">Export PDF</button>
              <button onclick="exportExcelSingle()">Export Excel</button>
            </div>
          </div>

          <!-- Bulk Slips Table -->
          <div id="all" style="display:none;margin-top:1rem;">
            <div class="exp-btns">
              <button onclick="exportPDF('salTbl','salarys.pdf')">Export PDF</button>
              <button onclick="exportTable('salTbl','salarys.xlsx')">Export Excel</button>
            </div>
            <table id="salTbl">
              <thead>
                <tr><th>ID</th><th>EmpID</th><th>Name</th><th>Role</th><th>Salary</th><th>Month-Year</th><th>Bank</th><th>IFSC</th><th>Address</th><th>Actions</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- USERS -->
      <div id="usr" class="section collapsed">
        <div class="hdr" onclick="toggle(this)">
          <h2>User Management</h2><span class="arrow">▼</span>
        </div>
        <div class="cnt">
          <form onsubmit="addUser();return false;">
            <input id="u-name" placeholder="Username" required/>
            <input id="u-pass" type="password" placeholder="Password" required/>
            <select id="u-role" required><option>admin</option><option>user</option></select>
            <button>Add User</button>
          </form>
          <div class="exp-btns">
            <button onclick="exportTable('usrTbl','users.xlsx')">Export Excel</button>
            <button onclick="exportPDF('usr','users.pdf')">Export PDF</button>
          </div>
          <table id="usrTbl"><thead><tr><th>ID</th><th>Username</th><th>Role</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
      </div>

      <!-- BACKUP -->
      <div id="bak" class="section collapsed">
        <div class="hdr" onclick="toggle(this)">
          <h2>Data Backup</h2><span class="arrow">▼</span>
        </div>
        <div class="cnt">
          <button onclick="manualBak()">Backup Now</button>
          <p style="margin:.5rem 0;">Automatic backup every 5 minutes</p>
          <table id="bakTbl"><thead><tr><th>#</th><th>Timestamp</th><th>Download</th></tr></thead><tbody></tbody></table>
        </div>
      </div>

    </main>
  </div>

  <script>
    /* ===== STATE & PERSISTENCE ===== */
    let role=null;
    let users=[], employees=[], attendance=[], salaryRecords=[];
    function save(){
      localStorage.erp = JSON.stringify({users,employees,attendance,salaryRecords});
    }
    function load(){
      if(localStorage.erp){
        const st = JSON.parse(localStorage.erp);
        Object.assign(window, st);
      } else {
        users=[{id:1,username:'Harshit',password:'12345',role:'admin'}];
        employees=[]; attendance=[]; salaryRecords=[];
        save();
      }
    }

    /* ===== LOGIN ===== */
    function doLogin(){
      load();
      const u=el('li-user').value.trim(),
            p=el('li-pass').value,
            me=users.find(x=>x.username===u && x.password===p),
            err=el('li-err');
      if(!me){ err.style.display='block'; return false; }
      role=me.role;
      el('login').style.display='none';
      el('app').style.display='block';
      init();
      return false;
    }
    function logout(){ location.reload(); }

    /* ===== NAV & COLLAPSE ===== */
    function show(id){
      ['emp','att','sal','usr','bak'].forEach(x=>{
        el(x).style.display = x===id ? 'block':'none';
        el('nav-'+x).classList.toggle('active', x===id);
      });
    }
    function toggle(h){ h.parentNode.classList.toggle('collapsed'); }

    /* ===== EMPLOYEES ===== */
    function addEmp(){
      if(role!=='admin')return;
      const e={id:employees.length+1,
        name:el('e-name').value, role:el('e-role').value,
        sal:+el('e-sal').value, bank:el('e-bank').value,
        ifsc:el('e-ifsc').value, addr:el('e-addr').value,
        att:el('e-att').files[0]?.name||''};
      employees.push(e);
      save(); renderEmp(); populateEmp();
    }
    function renderEmp(){
      qs('#empTbl tbody').innerHTML = employees.map(e=>
        `<tr>
          <td>${e.id}</td><td>${e.name}</td><td>${e.role}</td><td>${e.sal}</td>
          <td>${e.bank}</td><td>${e.ifsc}</td><td>${e.addr}</td><td>${e.att}</td>
          <td>${adminBtns('emp2',e.id)}</td>
        </tr>`
      ).join('');
    }
    function delEmp2(i){ if(role!=='admin')return; employees=employees.filter(x=>x.id!==i); save(); renderEmp(); renderAtt(); populateEmp();}
    function editEmp2(i){
      if(role!=='admin')return;
      editItem(employees,i,[
        {key:'name',label:'Name'},
        {key:'role',label:'Role'},
        {key:'sal',label:'Salary'},
        {key:'bank',label:'Bank A/C'},
        {key:'ifsc',label:'IFSC'},
        {key:'addr',label:'Address'}
      ]);
      save(); renderEmp(); renderAtt(); populateEmp();
    }

    /* ===== ATTENDANCE ===== */
    function addAtt(){
      const a={id:attendance.length+1,
        eid:+el('att-emp2').value,
        date:el('att-date').value,
        tin:el('att-in2').value,
        tout:el('att-out2').value};
      attendance.push(a); save(); renderAtt();
    }
    function renderAtt(){
      qs('#attTbl2 tbody').innerHTML = attendance.map(a=>
        `<tr>
          <td>${a.id}</td><td>${employees.find(e=>e.id===a.eid)?.name||'–'}</td>
          <td>${a.date}</td><td>${a.tin}</td><td>${a.tout}</td>
          <td>${adminBtns('att2',a.id)}</td>
        </tr>`
      ).join('');
    }
    function delAtt2(i){ if(role!=='admin')return; attendance=attendance.filter(x=>x.id!==i); save(); renderAtt(); }
    function editAtt2(i){
      if(role!=='admin')return;
      editItem(attendance,i,[
        {key:'date',label:'Date'},
        {key:'tin', label:'In Time'},
        {key:'tout',label:'Out Time'}
      ]);
      save(); renderAtt();
    }

    /* ===== SALARY ===== */
    function genSingle(){
      const id = +el('sal-emp2').value,
            e = employees.find(x=>x.id===id);
      if(!e) return;
      const m=el('sal-month').value, y=el('sal-year').value;
      el('one-n').innerText=e.name;
      el('one-r').innerText=e.role;
      el('one-d').innerText=`${m} ${y}`;
      el('one-s').innerText=e.sal;
      el('one').style.display='block';
    }
    function genAll(){
      const m=el('sal-month').value, y=el('sal-year').value;
      salaryRecords = employees.map((e,i)=>({
        id:i+1, empId:e.id, name:e.name, role:e.role,
        sal:e.sal, month:m, year:y, bank:e.bank, ifsc:e.ifsc, addr:e.addr
      }));
      save(); renderSalary();
    }
    function renderSalary(){
      qs('#salTbl tbody').innerHTML = salaryRecords.map(r=>
        `<tr>
          <td>${r.id}</td><td>${r.empId}</td><td>${r.name}</td><td>${r.role}</td>
          <td>${r.sal}</td><td>${r.month}-${r.year}</td>
          <td>${r.bank}</td><td>${r.ifsc}</td><td>${r.addr}</td>
          <td>${adminBtns('sal',r.id)}</td>
        </tr>`
      ).join('');
      el('all').style.display = salaryRecords.length?'block':'none';
    }
    function delSal(i){ if(role!=='admin')return; salaryRecords=salaryRecords.filter(x=>x.id!==i); save(); renderSalary(); }
    function editSal(i){
      if(role!=='admin')return;
      editItem(salaryRecords,i,[
        {key:'month',label:'Month'},
        {key:'year', label:'Year'},
        {key:'sal',  label:'Salary'}
      ]);
      save(); renderSalary();
    }

    /* ===== USER MANAGEMENT ===== */
    function addUser(){
      if(role!=='admin') return;
      const u={id:users.length+1,
        username:el('u-name').value,
        password:el('u-pass').value, role:el('u-role').value};
      users.push(u); save(); renderUsers();
    }
    function renderUsers(){
      qs('#usrTbl tbody').innerHTML = users.map(u=>
        `<tr>
          <td>${u.id}</td><td>${u.username}</td><td>${u.role}</td>
          <td>${adminBtns('usr',u.id)}</td>
        </tr>`
      ).join('');
    }
    function delUsr(i){ if(role!=='admin')return; users=users.filter(x=>x.id!==i); save(); renderUsers(); }
    function editUsr(i){
      if(role!=='admin')return;
      editItem(users,i,[
        {key:'username',label:'Username'},
        {key:'password',label:'Password'},
        {key:'role',    label:'Role'}
      ]);
      save(); renderUsers();
    }

    /* ===== BACKUP ===== */
    function manualBak(){ save(); addBak(); renderBak(); }
    function addBak(){
      let bak = JSON.parse(localStorage.bak||'[]');
      bak.push({ts:new Date().toLocaleString(),st:JSON.parse(localStorage.erp)});
      localStorage.bak = JSON.stringify(bak);
    }
    function renderBak(){
      const bak = JSON.parse(localStorage.bak||'[]'),
            tb  = qs('#bakTbl tbody');
      tb.innerHTML = bak.map((b,i)=>
        `<tr><td>${i+1}</td><td>${b.ts}</td>
          <td><button onclick="dl(${i})">⬇️</button></td></tr>`
      ).join('');
    }
    function dl(i){
      const bak = JSON.parse(localStorage.bak)[i];
      const blob = new Blob([JSON.stringify(bak.st)],{type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `backup_${i+1}.json`;
      a.click();
    }
    setInterval(manualBak,300000);

    /* ===== HELPERS ===== */
    function el(id){ return document.getElementById(id); }
    function qs(sel){ return document.querySelector(sel); }
    function cap(s){ return s.charAt(0).toUpperCase()+s.slice(1); }
    function adminBtns(mod,id){
      if(role!=='admin') return '';
      return `<div class="actions">
        <button onclick="edit${cap(mod)}(${id})">✎</button>
        <button onclick="del${cap(mod)}(${id})">🗑</button>
      </div>`;
    }
    function editItem(arr,id,fields){
      const o = arr.find(x=>x.id===id),
            vals = fields.map(f=>prompt(f.label,o[f.key]));
      if(vals.every(v=>v!==null)){
        fields.forEach((f,i)=>o[f.key]=vals[i]);
      }
    }

    // Export
    function exportTable(id,file){
      const wb = XLSX.utils.book_new(),
            ws = XLSX.utils.table_to_sheet(el(id));
      XLSX.utils.book_append_sheet(wb,ws,'Sheet1');
      XLSX.writeFile(wb,file);
    }
    function exportPDF(id,file){
      html2pdf().set({margin:0.5,filename:file,html2canvas:{scale:2}})
               .from(el(id)).save();
    }
    function exportExcelSingle(){
      const data=[
        ['Field','Value'],
        ['Name', el('one-n').innerText],
        ['Role', el('one-r').innerText],
        ['Date', el('one-d').innerText],
        ['Salary',el('one-s').innerText]
      ];
      const wb=XLSX.utils.book_new(),
            ws=XLSX.utils.aoa_to_sheet(data);
      XLSX.utils.book_append_sheet(wb,ws,'Slip');
      XLSX.writeFile(wb,'slip.xlsx');
    }

    // Populate employee selects
    function populateEmp(){
      ['att-emp2','sal-emp2'].forEach(id=>{
        const s=el(id); s.innerHTML='<option>--Select--</option>';
        employees.forEach(e=> s.innerHTML+=`<option value="${e.id}">${e.name}</option>`);
      });
    }

    /* ===== INITIALIZE ===== */
    function init(){
      show('emp'); // default
      renderEmp(); renderAtt(); renderSalary(); renderUsers(); renderBak();
      populateEmp();
    }
    window.addEventListener('DOMContentLoaded', load);
  </script>
</body>
</html>
